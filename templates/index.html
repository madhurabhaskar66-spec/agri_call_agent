<!DOCTYPE html>
<html>
<head>
    <title>ðŸŒ¾ Agriculture Voice Assistant</title>
</head>
<body>

<h2>ðŸŒ¾ Agriculture Voice Assistant</h2>

<button onclick="startListening()">ðŸŽ¤ Speak</button>

<p><b>You:</b> <span id="userText"></span></p>
<p><b>AI:</b> <span id="response"></span></p>

<script>

// ðŸ”Š TEXT TO SPEECH (Output Voice)
function speak(text, lang="en-US") {
    window.speechSynthesis.cancel();

    const speech = new SpeechSynthesisUtterance(text);
    speech.lang = lang;
    speech.pitch = 1.3;
    speech.rate = 1;

    window.speechSynthesis.speak(speech);
}


// ðŸŽ¤ SPEECH TO TEXT (Input Voice)
function startListening() {

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

    recognition.lang = "auto";   // multilingual
    recognition.interimResults = false;

    recognition.start();

    recognition.onresult = async function(event) {

        const userSpeech = event.results[0][0].transcript;

        document.getElementById("userText").innerText = userSpeech;

        // Send to backend
        const response = await fetch("http://127.0.0.1:8000/chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ message: userSpeech })
        });

        const data = await response.json();

        document.getElementById("response").innerText = data.reply;

        // Speak response
        speak(data.reply);
    };
}

</script>

</body>
</html>